<!DOCTYPE html>
<html>
<head>
    <title>Monthly Earnings Calculator</title>
    <script>
        function getTaxRate(annualEarnings) {
            const lowerThreshold = 42000; // €42,000
            const lowerRate = 0.2; // 20%
            const higherRate = 0.4; // 40%

            if (annualEarnings <= lowerThreshold) {
                return lowerRate;
            } else {
                return higherRate;
            }
        }

        function calculateCommission(capacity) {
            if (capacity <= 25) {
                return 0.5;
            } else if (capacity <= 50) {
                return 0.475;
            } else if (capacity <= 70) {
                return 0.45;
            } else if (capacity <= 80) {
                return 0.425;
            } else if (capacity <= 90) {
                return 0.4;
            } else if (capacity <= 95) {
                return 0.375;
            } else {
                return 0.35;
            }
        }

        function calculateEarnings() {
            const sessionCost = parseFloat(document.getElementById('sessionCost').value);
            const sessionsPerDay = parseFloat(document.getElementById('sessionsPerDay').value);
            const emptyFee = parseFloat(document.getElementById('emptyFee').value);
            const needleCost = parseFloat(document.getElementById('needleCost').value);
            const workingDaysPerWeek = parseFloat(document.getElementById('workingDaysPerWeek').value);
            const vacationWeeks = parseFloat(document.getElementById('vacationWeeks').value);
            const extraDaysOff = parseFloat(document.getElementById('extraDaysOff').value);

            const workingWeeks = 52 - vacationWeeks;
            const totalWorkdays = (workingWeeks * workingDaysPerWeek) - extraDaysOff;

            // Calculate capacity percentage based on sessions per day
            let capacity = (sessionsPerDay / 7) * 100;

            const commissionRate = calculateCommission(capacity);

            const dailyRevenue = sessionsPerDay * sessionCost;
            const dailyCommission = dailyRevenue * commissionRate;
            const dailyEarningsAfterCommission = dailyRevenue - dailyCommission;

            const totalDailyExpenses = emptyFee + needleCost;
            const dailyEarningsAfterExpenses = dailyEarningsAfterCommission - totalDailyExpenses;

            const annualEarnings = dailyEarningsAfterExpenses * totalWorkdays;
            const taxRate = getTaxRate(annualEarnings);

            const annualEarningsAfterTax = annualEarnings * (1 - taxRate);

            const monthlyEarningsAfterTax = annualEarningsAfterTax / 12;

            // Update UI with calculated capacity percentage
            document.getElementById('capacityPercentage').innerText = `Capacity: ${capacity.toFixed(2)}%`;

            // Update UI with calculated monthly earnings after tax
            document.getElementById('result').innerText = `Monthly Earnings After Tax: €${monthlyEarningsAfterTax.toFixed(2)}`;
            
            // Update UI with tax rate
            document.getElementById('taxRateLabel').innerText = `Tax Rate: ${taxRate * 100}%`;
        }

        // Function to execute calculations on page load
        window.onload = function() {
            calculateEarnings();
        };
    </script>
</head>
<body>
    <h1>Monthly Earnings Calculator</h1>
    <form>
        <label for="sessionCost">Average Session Cost (€):</label>
        <input type="number" id="sessionCost" value="82.50"><br><br>

        <label for="sessionsPerDay">Sessions per Day (Max 7):</label>
        <input type="number" id="sessionsPerDay" value="7" min="1" max="7" oninput="updateCapacityLabel()"><br>
        <label id="capacityPercentage"></label><br><br>

        <label for="emptyFee">Empty Appointment Fee (€):</label>
        <input type="number" id="emptyFee" value="10"><br><br>

        <label for="needleCost">Needle Cost (€):</label>
        <input type="number" id="needleCost" value="7"><br><br>

        <label for="workingDaysPerWeek">Working Days per Week:</label>
        <input type="number" id="workingDaysPerWeek" value="4"><br><br>

        <label for="vacationWeeks">Vacation Weeks per Year:</label>
        <input type="number" id="vacationWeeks" value="5"><br><br>

        <label for="extraDaysOff">Extra Days Off per Year:</label>
        <input type="number" id="extraDaysOff" value="10"><br><br>

        <button type="button" onclick="calculateEarnings()">Calculate</button>
    </form>
    <h2 id="result">Monthly Earnings After Tax: €0.00</h2>
    <label id="taxRateLabel"></label>

    <script>
        // Function to update capacity percentage label dynamically
        function updateCapacityLabel() {
            const sessionsPerDay = parseFloat(document.getElementById('sessionsPerDay').value);
            const capacity = (sessionsPerDay / 7) * 100;
            document.getElementById('capacityPercentage').innerText = `Capacity: ${capacity.toFixed(2)}%`;
        }
    </script>
</body>
</html>
